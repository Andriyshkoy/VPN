from aiogram.filters import Command, CommandObject
from aiogram.types import Message

from .base import get_or_create_user, router

__all__ = ["cmd_start", "cmd_help", "cmd_how_to_use", "cmd_balance"]


@router.message(Command("start"))
async def cmd_start(message: Message, command: CommandObject | None = None) -> None:
    ref_id = command.args if command and command.args else None
    await get_or_create_user(message.from_user.id, message.from_user.username, ref_id=ref_id)
    welcome_text = (
        "üëã <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ VPN –±–æ—Ç!</b>\n\n"
        "üîê <b>–ß—Ç–æ —Ç–∞–∫–æ–µ OVPN?</b>\n"
        "OVPN ‚Äî —ç—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VPN —á–µ—Ä–µ–∑ OpenVPN. "
        "–í—ã –ø—Ä–æ—Å—Ç–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç–µ –µ–≥–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî –∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç–µ—Å—å –∫ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é.\n\n"
        "üí° <b>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:</b>\n"
        "‚Ä¢ –î–µ—à–µ–≤–ª–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∞–Ω–∞–ª–æ–≥–æ–≤: –≤—Å–µ–≥–æ 10‚ÇΩ –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ 50‚ÇΩ –≤ –º–µ—Å—è—Ü\n"
        "‚Ä¢ –ù–µ—Å–∫–æ–ª—å–∫–æ –ª–æ–∫–∞—Ü–∏–π –Ω–∞ –≤—ã–±–æ—Ä\n"
        "‚Ä¢ –ü—Ä–æ—Å—Ç–æ–µ –∏ –±—ã—Å—Ç—Ä–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ\n"
        "‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º: Windows, macOS, Linux, Android, iOS, Smart TV –∏ –¢–í-–ø—Ä–∏—Å—Ç–∞–≤–æ–∫\n"
        "‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ –ø—Ä—è–º–æ –≤ Telegram\n\n"
        "üìå <b>–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n"
        "‚Ä¢ /create_config ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é\n"
        "‚Ä¢ /configs ‚Äî —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π\n"
        "‚Ä¢ /balance ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å\n"
        "‚Ä¢ /topup ‚Äî –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å\n"
        "‚Ä¢ /how_to_use ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∫ VPN\n"
        "‚Ä¢ /referrals ‚Äî —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞\n\n"
        "üë• –ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–Ω—É—Å—ã ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /referrals –¥–ª—è —Å—Å—ã–ª–∫–∏\n\n"
        "‚ÑπÔ∏è –î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /help"
    )
    await message.answer(welcome_text, parse_mode="HTML")


@router.message(Command("help"))
async def cmd_help(message: Message) -> None:
    help_text = (
        "üìå <b>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:</b>\n\n"
        "‚Ä¢ /start - –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º\n"
        "‚Ä¢ /how_to_use - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∫ VPN\n"
        "‚Ä¢ /help - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É\n"
        "‚Ä¢ /balance - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞—à —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å\n"
        "‚Ä¢ /topup - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞\n"
        "‚Ä¢ /configs - —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π\n"
        "‚Ä¢ /create_config - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é\n"
        "‚Ä¢ /referrals - —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞\n\n"
        "<b>–°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥:</b>\n"
        "‚Ä¢ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ‚Äî 10 —Ä—É–±–ª–µ–π (—Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É)\n"
        "‚Ä¢ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ‚Äî 50 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü, —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ\n\n"
        "<b>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º:</b>\n"
        "1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å —Å –ø–æ–º–æ—â—å—é /balance\n"
        "2. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ /topup\n"
        "3. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏—Å–ø–æ–ª—å–∑—É—è /create_config\n"
        "4. –°–∫–∞—á–∞–π—Ç–µ .ovpn —Ñ–∞–π–ª –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ –≤–∞—à VPN –∫–ª–∏–µ–Ω—Ç\n"
        "5. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ /configs"
    )
    await message.answer(help_text, parse_mode="HTML")


@router.message(Command("how_to_use"))
async def cmd_how_to_use(message: Message) -> None:
    help_text = (
        "üîê <b>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VPN: –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</b>\n\n"
        "–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã:\n"
        "1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ VPN-–∫–ª–∏–µ–Ω—Ç\n"
        "2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é\n"
        "3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ\n\n"

        "‚ñ´Ô∏è‚ñ´Ô∏è‚ñ´Ô∏è\n\n"
        "üñ• <b>Windows</b>\n"
        "1. –°–∫–∞—á–∞–π—Ç–µ <a href=\"https://openvpn.net/client-connect-vpn-for-windows/\">OpenVPN Connect</a>\n"
        "2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí <b>¬´+ Import Profile¬ª</b>\n"
        "3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π <code>.ovpn</code>-—Ñ–∞–π–ª\n"
        "4. –ù–∞–∂–º–∏—Ç–µ <b>Connect</b>\n\n"

        "‚ñ´Ô∏è‚ñ´Ô∏è‚ñ´Ô∏è\n\n"
        "üçé <b>macOS</b>\n"
        "1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ <a href=\"https://tunnelblick.net/\">Tunnelblick</a>\n"
        "2. –î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ <code>.ovpn</code>-—Ñ–∞–π–ª ‚Üí <b>¬´Import¬ª</b>\n"
        "3. –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ –∏–∫–æ–Ω–∫—É –≤ —Å—Ç—Ä–æ–∫–µ –º–µ–Ω—é\n\n"

        "‚ñ´Ô∏è‚ñ´Ô∏è‚ñ´Ô∏è\n\n"
        "üì± <b>Android</b>\n"
        "1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ <a href=\"https://play.google.com/store/apps/details?id=net.openvpn.openvpn\">OpenVPN Connect</a>\n"
        "2. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: <b>File</b> ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ <code>.ovpn</code>\n"
        "3. –ù–∞–∂–º–∏—Ç–µ <b>Connect</b>\n\n"

        "‚ñ´Ô∏è‚ñ´Ô∏è‚ñ´Ô∏è\n\n"
        "üì± <b>iOS (iPhone/iPad)</b>\n"
        "1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ <a href=\"https://apps.apple.com/app/openvpn-connect/id590379981\">OpenVPN Connect</a>\n"
        "2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ <code>.ovpn</code>-—Ñ–∞–π–ª –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ <b>–§–∞–π–ª—ã</b>:\n"
        "   ‚Ä¢ –í Telegram: –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Ñ–∞–π–ª ‚Üí <b>‚Ä¢‚Ä¢‚Ä¢</b> ‚Üí <b>Share</b> ‚Üí <b>Save to Files</b>\n"
        "3. –û—Ç–∫—Ä–æ–π—Ç–µ <b>OpenVPN Connect</b> ‚Üí <b>+</b> ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ <b>On My iPhone</b>\n"
        "4. –ù–∞–∂–º–∏—Ç–µ <b>Add</b> ‚Üí <b>Connect</b>\n\n"

        "‚ñ´Ô∏è‚ñ´Ô∏è‚ñ´Ô∏è\n\n"
        "üÜò <b>–í–æ–∑–Ω–∏–∫–ª–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏?</b>\n"
        "–ü–∏—à–∏—Ç–µ <a href=\"https://t.me/andriyshkoy\">@andriyshkoy</a> ‚Äî –ø–æ–º–æ–∂–µ–º!"
    )
    await message.answer(help_text, parse_mode="HTML", disable_web_page_preview=True)


@router.message(Command("balance"))
async def cmd_balance(message: Message) -> None:
    user = await get_or_create_user(message.from_user.id, message.from_user.username)
    await message.answer(f"–í–∞—à –±–∞–ª–∞–Ω—Å: {user.balance}")
